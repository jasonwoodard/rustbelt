{
  "version": 3,
  "sources": ["../src/io/dayOfApp/recommendation.ts", "../src/io/dayOfApp/posterior.ts", "../src/io/dayOfApp/state.ts", "../src/io/dayOfApp/index.ts"],
  "sourcesContent": ["import type { Posterior, PosteriorPoolPosterior } from './posterior';\n\nexport interface RecommendationMeta {\n  decision: 'Stay' | 'Leave';\n  reason: string;\n  diff: number | null;\n  zScore: number | null;\n  currentUcb: number | null;\n  remainingUcb: number | null;\n  observationCount: number;\n}\n\nexport function getRecommendation(\n  currentPosterior: Posterior | null | undefined,\n  poolPosterior: PosteriorPoolPosterior | null | undefined,\n  mqaKey: string,\n  mqaValue: number | null | undefined,\n): RecommendationMeta {\n  const fallbackCurrentUcb = typeof mqaValue === 'number' ? mqaValue : null;\n  const derivedCurrentUcb =\n    currentPosterior && typeof currentPosterior.upper === 'number' ? currentPosterior.upper : null;\n  const currentUcb = derivedCurrentUcb ?? fallbackCurrentUcb;\n  const derivedRemainingUcb =\n    poolPosterior && typeof poolPosterior.upper === 'number' ? poolPosterior.upper : null;\n  const fallbackRemainingUcb =\n    poolPosterior && typeof poolPosterior.mean === 'number' ? poolPosterior.mean : null;\n  const remainingUcb = derivedRemainingUcb ?? fallbackRemainingUcb;\n  const observationCount = currentPosterior?.observationCount ?? 0;\n\n  if (mqaKey === 'Bust') {\n    const diff =\n      currentUcb != null && remainingUcb != null ? currentUcb - remainingUcb : currentUcb ?? null;\n    return {\n      decision: 'Leave',\n      reason: 'mqa-bust',\n      diff,\n      zScore: null,\n      currentUcb,\n      remainingUcb,\n      observationCount,\n    };\n  }\n\n  if (!currentPosterior || currentUcb == null) {\n    return {\n      decision: 'Leave',\n      reason: 'no-current-posterior',\n      diff: null,\n      zScore: null,\n      currentUcb,\n      remainingUcb,\n      observationCount,\n    };\n  }\n\n  if (!poolPosterior || poolPosterior.count === 0 || remainingUcb == null) {\n    return {\n      decision: 'Stay',\n      reason: 'no-remaining-stops',\n      diff: currentUcb,\n      zScore: null,\n      currentUcb,\n      remainingUcb,\n      observationCount,\n    };\n  }\n\n  const diff = currentUcb - remainingUcb;\n  const combinedStd = Math.sqrt(\n    currentPosterior.std * currentPosterior.std + poolPosterior.std * poolPosterior.std,\n  );\n  const zScore =\n    combinedStd > 0\n      ? diff / combinedStd\n      : diff >= 0\n      ? Number.POSITIVE_INFINITY\n      : Number.NEGATIVE_INFINITY;\n\n  if (diff > 0) {\n    return {\n      decision: 'Stay',\n      reason: 'ucb-favors-current',\n      diff,\n      zScore,\n      currentUcb,\n      remainingUcb,\n      observationCount,\n    };\n  }\n\n  return {\n    decision: 'Leave',\n    reason: diff === 0 ? 'ucb-tie' : 'ucb-favors-remaining',\n    diff,\n    zScore,\n    currentUcb,\n    remainingUcb,\n    observationCount,\n  };\n}\n", "export const SCORE_MIN = 0;\nexport const SCORE_MAX = 5;\nexport const SCORE_RANGE = SCORE_MAX - SCORE_MIN;\nexport const EPSILON = 1e-6;\n\nexport type StopStatus = 'tovisit' | 'visited' | 'dropped';\n\nexport interface PosteriorConfig {\n  priorStrength: number;\n  baseAlpha: number;\n  baseBeta: number;\n  credibleZ: number;\n  defaultScore: number;\n}\n\nexport interface Posterior {\n  alpha: number;\n  beta: number;\n  meanNormalized: number;\n  mean: number;\n  std: number;\n  variance: number;\n  lower: number;\n  upper: number;\n  observationCount: number;\n  totalQuality: number;\n  lastObservation: number | null;\n  priorNormalized: number;\n  pseudo: number;\n}\n\nexport interface PosteriorSummary {\n  alpha: number;\n  beta: number;\n  mean: number;\n  meanNormalized: number;\n  std: number;\n  variance: number;\n  lower: number;\n  upper: number;\n  observationCount: number;\n  totalQuality: number;\n  lastObservation: number | null;\n  priorNormalized: number;\n  pseudo: number;\n}\n\nexport interface PosteriorPoolState {\n  observedAlpha: number;\n  observedBeta: number;\n  observationCount: number;\n  totalObservedQuality: number;\n  lastObservation: number | null;\n}\n\nexport interface PosteriorPoolSummary {\n  alpha: number;\n  beta: number;\n  mean: number;\n  meanNormalized: number;\n  std: number;\n  variance: number;\n  lower: number;\n  upper: number;\n  count: number;\n  pseudoAlpha: number;\n  pseudoBeta: number;\n  observationCount: number;\n  totalObservedQuality: number;\n}\n\nexport interface StopPosteriorInput {\n  id: string | number;\n  status: StopStatus;\n  score?: number;\n  posterior: Posterior;\n}\n\nexport interface PosteriorPoolPosterior extends PosteriorPoolSummary {}\n\nexport function clamp(value: number, min: number, max: number): number {\n  return Math.min(Math.max(value, min), max);\n}\n\nexport function normalizeScore(value: number | null | undefined, config: PosteriorConfig): number {\n  const safeValue = typeof value === 'number' ? value : config.defaultScore;\n  return clamp((safeValue - SCORE_MIN) / SCORE_RANGE, 0, 1);\n}\n\nexport function denormalizeScore(normalized: number): number {\n  return SCORE_MIN + clamp(normalized, 0, 1) * SCORE_RANGE;\n}\n\nexport function formatScore(value: number | null | undefined): string {\n  if (typeof value !== 'number') return '0.0';\n  return value.toFixed(1);\n}\n\nexport function recomputePosteriorStats(posterior: Posterior, config: PosteriorConfig): Posterior {\n  posterior.alpha = Math.max(posterior.alpha, EPSILON);\n  posterior.beta = Math.max(posterior.beta, EPSILON);\n  const total = posterior.alpha + posterior.beta;\n  const meanNormalized = posterior.alpha / total;\n  const varianceNormalized = (posterior.alpha * posterior.beta) / ((total + 1) * total * total);\n  const stdScore = Math.sqrt(Math.max(varianceNormalized, 0)) * SCORE_RANGE;\n  posterior.meanNormalized = meanNormalized;\n  posterior.mean = denormalizeScore(meanNormalized);\n  posterior.std = stdScore;\n  posterior.lower = clamp(posterior.mean - config.credibleZ * stdScore, SCORE_MIN, SCORE_MAX);\n  posterior.upper = clamp(posterior.mean + config.credibleZ * stdScore, SCORE_MIN, SCORE_MAX);\n  posterior.variance = stdScore * stdScore;\n  return posterior;\n}\n\nexport function createPosterior(baseScore: number | null | undefined, config: PosteriorConfig): Posterior {\n  const normalized = normalizeScore(baseScore, config);\n  const pseudo = config.priorStrength;\n  const posterior: Posterior = {\n    alpha: config.baseAlpha + normalized * pseudo,\n    beta: config.baseBeta + (1 - normalized) * pseudo,\n    priorNormalized: normalized,\n    pseudo,\n    observationCount: 0,\n    totalQuality: 0,\n    lastObservation: null,\n    meanNormalized: 0,\n    mean: 0,\n    std: 0,\n    variance: 0,\n    lower: SCORE_MIN,\n    upper: SCORE_MAX,\n  };\n  return recomputePosteriorStats(posterior, config);\n}\n\nexport function updatePosteriorWithObservation(\n  posterior: Posterior,\n  mqaValue: number,\n  config: PosteriorConfig,\n): Posterior {\n  const normalized = normalizeScore(mqaValue, config);\n  posterior.alpha += normalized;\n  posterior.beta += 1 - normalized;\n  posterior.observationCount = (posterior.observationCount ?? 0) + 1;\n  posterior.totalQuality = (posterior.totalQuality ?? 0) + mqaValue;\n  posterior.lastObservation = mqaValue;\n  return recomputePosteriorStats(posterior, config);\n}\n\nexport function computeBetaStats(\n  alpha: number,\n  beta: number,\n  config: PosteriorConfig,\n): Omit<Posterior, 'observationCount' | 'totalQuality' | 'lastObservation' | 'priorNormalized' | 'pseudo'> {\n  const safeAlpha = Math.max(alpha, EPSILON);\n  const safeBeta = Math.max(beta, EPSILON);\n  const total = safeAlpha + safeBeta;\n  const meanNormalized = safeAlpha / total;\n  const varianceNormalized = (safeAlpha * safeBeta) / ((total + 1) * total * total);\n  const stdScore = Math.sqrt(Math.max(varianceNormalized, 0)) * SCORE_RANGE;\n  const meanScore = denormalizeScore(meanNormalized);\n  const lower = clamp(meanScore - config.credibleZ * stdScore, SCORE_MIN, SCORE_MAX);\n  const upper = clamp(meanScore + config.credibleZ * stdScore, SCORE_MIN, SCORE_MAX);\n  return {\n    alpha: safeAlpha,\n    beta: safeBeta,\n    meanNormalized,\n    mean: meanScore,\n    std: stdScore,\n    variance: stdScore * stdScore,\n    lower,\n    upper,\n  };\n}\n\nexport function computeRemainingPoolPosterior(\n  stops: readonly StopPosteriorInput[],\n  config: PosteriorConfig,\n  pool: PosteriorPoolState,\n  excludeId?: string | number,\n): PosteriorPoolPosterior {\n  let pseudoAlpha = 0;\n  let pseudoBeta = 0;\n  const remainingStops = stops.filter(\n    (stop) => stop.status === 'tovisit' && (excludeId === undefined || String(stop.id) !== String(excludeId)),\n  );\n\n  for (const stop of remainingStops) {\n    const priorNorm = stop.posterior?.priorNormalized ?? normalizeScore(stop.score, config);\n    const pseudo = stop.posterior?.pseudo ?? config.priorStrength;\n    pseudoAlpha += priorNorm * pseudo;\n    pseudoBeta += (1 - priorNorm) * pseudo;\n  }\n\n  const alpha = config.baseAlpha + pseudoAlpha + pool.observedAlpha;\n  const beta = config.baseBeta + pseudoBeta + pool.observedBeta;\n  const stats = computeBetaStats(alpha, beta, config);\n\n  return {\n    ...stats,\n    count: remainingStops.length,\n    pseudoAlpha,\n    pseudoBeta,\n    observationCount: pool.observationCount,\n    totalObservedQuality: pool.totalObservedQuality,\n  };\n}\n\nexport function serializePosterior(posterior: Posterior, config: PosteriorConfig): PosteriorSummary {\n  return {\n    alpha: posterior.alpha,\n    beta: posterior.beta,\n    mean: posterior.mean,\n    meanNormalized: posterior.meanNormalized,\n    std: posterior.std,\n    variance: posterior.variance,\n    lower: posterior.lower,\n    upper: posterior.upper,\n    observationCount: posterior.observationCount ?? 0,\n    totalQuality: posterior.totalQuality ?? 0,\n    lastObservation: posterior.lastObservation ?? null,\n    priorNormalized: posterior.priorNormalized ?? normalizeScore(config.defaultScore, config),\n    pseudo: posterior.pseudo ?? config.priorStrength,\n  };\n}\n\nexport function serializePool(poolPosterior: PosteriorPoolPosterior): PosteriorPoolSummary {\n  return {\n    alpha: poolPosterior.alpha,\n    beta: poolPosterior.beta,\n    mean: poolPosterior.mean,\n    meanNormalized: poolPosterior.meanNormalized,\n    std: poolPosterior.std,\n    variance: poolPosterior.variance,\n    lower: poolPosterior.lower,\n    upper: poolPosterior.upper,\n    count: poolPosterior.count,\n    pseudoAlpha: poolPosterior.pseudoAlpha,\n    pseudoBeta: poolPosterior.pseudoBeta,\n    observationCount: poolPosterior.observationCount,\n    totalObservedQuality: poolPosterior.totalObservedQuality,\n  };\n}\n\nexport function createPosteriorPoolState(): PosteriorPoolState {\n  return {\n    observedAlpha: 0,\n    observedBeta: 0,\n    observationCount: 0,\n    totalObservedQuality: 0,\n    lastObservation: null,\n  };\n}\n\nexport function updatePoolObservation(\n  pool: PosteriorPoolState,\n  mqaValue: number,\n  config: PosteriorConfig,\n): void {\n  const normalized = normalizeScore(mqaValue, config);\n  pool.observedAlpha += normalized;\n  pool.observedBeta += 1 - normalized;\n  pool.observationCount += 1;\n  pool.totalObservedQuality += mqaValue;\n  pool.lastObservation = mqaValue;\n}\n", "import type { RecommendationMeta } from './recommendation';\nimport {\n  createPosterior,\n  createPosteriorPoolState,\n  formatScore,\n  Posterior,\n  PosteriorConfig,\n  PosteriorPoolState,\n  PosteriorPoolSummary,\n  PosteriorSummary,\n} from './posterior';\n\nexport interface RawStop {\n  id: string;\n  name: string;\n  type: string;\n  arrive: string;\n  depart: string;\n  score?: number;\n  lat?: number;\n  lon?: number;\n  address?: string;\n  [key: string]: unknown;\n}\n\nexport interface RawDay {\n  dayId: string;\n  stops: RawStop[];\n}\n\nexport interface RawItinerary {\n  runTimestamp?: string;\n  runId?: string;\n  runNote?: string;\n  days?: RawDay[];\n}\n\nexport interface StopLogEntry {\n  name: string;\n  mapsUrl: string | null;\n  mqa: string;\n  mqaValue: number | null;\n  decision: string;\n  decisionReason: string;\n  diff: number | null;\n  zScore: number | null;\n  currentUcb: number | null;\n  remainingUcb: number | null;\n  observationCount: number | null;\n  posterior: PosteriorSummary;\n  pool: PosteriorPoolSummary | null;\n  timestamp: string;\n}\n\nexport interface StopState extends RawStop {\n  status: 'tovisit' | 'visited' | 'dropped';\n  posterior: Posterior;\n  posteriorSummary?: PosteriorSummary & {\n    diff: number | null;\n    zScore: number | null;\n    currentUcb: number | null;\n    remainingUcb: number | null;\n  };\n  mapsUrl: string | null;\n  mqa?: string;\n  mqaValue?: number;\n  decision?: string;\n  decisionReason?: string;\n}\n\nexport interface PendingDrop {\n  stopId?: string | number;\n  id?: string | number;\n}\n\nexport interface RecommendationSnapshot {\n  recommendation: string;\n  meta: RecommendationMeta;\n  currentPosterior: PosteriorSummary;\n  poolPosterior: PosteriorPoolSummary | null;\n}\n\nexport interface AppState {\n  itinerary: RawItinerary | null;\n  stops: StopState[];\n  currentIndex: number;\n  log: StopLogEntry[];\n  dayId: string | null;\n  pendingDrop: PendingDrop | null;\n  awaitingAdvance: boolean;\n  activeDecisionStopId: string | number | null;\n  lastRecommendation: RecommendationSnapshot | null;\n  mqaMap: Record<string, number>;\n  posteriorConfig: PosteriorConfig;\n  posteriorPool: PosteriorPoolState;\n}\n\nexport const DEFAULT_POSTERIOR_CONFIG: PosteriorConfig = {\n  priorStrength: 4,\n  baseAlpha: 1e-6,\n  baseBeta: 1e-6,\n  credibleZ: 1.0,\n  defaultScore: 3.5,\n};\n\nexport function createAppState(): AppState {\n  return {\n    itinerary: null,\n    stops: [],\n    currentIndex: 0,\n    log: [],\n    dayId: null,\n    pendingDrop: null,\n    awaitingAdvance: false,\n    activeDecisionStopId: null,\n    lastRecommendation: null,\n    mqaMap: {\n      Bust: 0.0,\n      Average: 3.5,\n      Good: 4.2,\n      Exceptional: 5.0,\n    },\n    posteriorConfig: { ...DEFAULT_POSTERIOR_CONFIG },\n    posteriorPool: createPosteriorPoolState(),\n  };\n}\n\nexport function mapRawStopToState(stop: RawStop, config: PosteriorConfig): StopState {\n  return {\n    ...stop,\n    status: 'tovisit',\n    posterior: createPosterior(stop.score, config),\n    mapsUrl: createMapsUrl(stop),\n  };\n}\n\nexport function createMapsUrl(stop: Pick<RawStop, 'lat' | 'lon' | 'name' | 'address'>): string | null {\n  const queryParts: string[] = [];\n  const hasLat = typeof stop.lat === 'number' && Number.isFinite(stop.lat);\n  const hasLon = typeof stop.lon === 'number' && Number.isFinite(stop.lon);\n  if (hasLat && hasLon) {\n    queryParts.push(`${stop.lat},${stop.lon}`);\n  }\n\n  if (typeof stop.name === 'string' && stop.name.trim()) {\n    queryParts.push(stop.name.trim());\n  }\n\n  if (typeof stop.address === 'string' && stop.address.trim()) {\n    queryParts.push(stop.address.trim());\n  }\n\n  if (queryParts.length === 0) {\n    return null;\n  }\n\n  const query = encodeURIComponent(queryParts.join(' '));\n  return `https://www.google.com/maps/search/?api=1&query=${query}`;\n}\n\nexport function selectActiveDay(days: RawDay[], preferredDayId?: string): RawDay | undefined {\n  if (preferredDayId) {\n    const match = days.find((d) => d?.dayId === preferredDayId);\n    if (match) return match;\n  }\n  return (\n    days.find((d) => Array.isArray(d?.stops) && d.stops.some((stop) => stop.type === 'store')) ??\n    days[0]\n  );\n}\n\nexport function findNextToVisitIndex(stops: StopState[]): number {\n  const index = stops.findIndex((s) => s.status === 'tovisit');\n  return index === -1 ? stops.length : index;\n}\n\nexport function summarizePosterior(posterior: Posterior): PosteriorSummary {\n  return {\n    alpha: posterior.alpha,\n    beta: posterior.beta,\n    mean: posterior.mean,\n    meanNormalized: posterior.meanNormalized,\n    std: posterior.std,\n    variance: posterior.variance,\n    lower: posterior.lower,\n    upper: posterior.upper,\n    observationCount: posterior.observationCount,\n    totalQuality: posterior.totalQuality,\n    lastObservation: posterior.lastObservation,\n    priorNormalized: posterior.priorNormalized,\n    pseudo: posterior.pseudo,\n  };\n}\n\nexport function buildPosteriorSummary(\n  posterior: Posterior,\n  meta: Pick<RecommendationMeta, 'diff' | 'zScore' | 'currentUcb' | 'remainingUcb'>,\n): StopState['posteriorSummary'] {\n  return {\n    ...summarizePosterior(posterior),\n    diff: meta.diff,\n    zScore: meta.zScore,\n    currentUcb: meta.currentUcb,\n    remainingUcb: meta.remainingUcb,\n  };\n}\n\nexport function createLogEntry(params: {\n  stop: StopState;\n  mqaKey: string;\n  mqaValue: number;\n  recommendation: string;\n  decisionReason: string;\n  decisionMeta: RecommendationMeta;\n  posteriorSummary: PosteriorSummary;\n  poolSummary: PosteriorPoolSummary | null;\n}): StopLogEntry {\n  const { stop, mqaKey, mqaValue, recommendation, decisionReason, decisionMeta, posteriorSummary, poolSummary } =\n    params;\n\n  return {\n    name: stop.name,\n    mapsUrl: stop.mapsUrl,\n    mqa: mqaKey,\n    mqaValue,\n    decision: recommendation,\n    decisionReason,\n    diff: decisionMeta.diff,\n    zScore: decisionMeta.zScore,\n    currentUcb: decisionMeta.currentUcb ?? null,\n    remainingUcb: decisionMeta.remainingUcb ?? null,\n    observationCount: decisionMeta.observationCount ?? null,\n    posterior: posteriorSummary,\n    pool: poolSummary,\n    timestamp: new Date().toISOString(),\n  };\n}\n\nexport function humanizeReason(reason: string | null | undefined): string {\n  if (!reason) return '';\n  const text = reason\n    .replace(/[-_]/g, ' ')\n    .replace(/\\b([a-z])/g, (m) => m.toUpperCase());\n  return text\n    .replace(/\\bMqa\\b/g, 'MQA')\n    .replace(/\\bUcb\\b/g, 'Upper Confidence Bound (UCB)');\n}\n\nexport function buildRunInfoText(runId: string | undefined, runNote: string | undefined): string | null {\n  const runLabel = runId ?? 'Unknown Run';\n  const runNoteText = runNote ? ` - ${runNote}` : '';\n  const text = `Run ID: ${runLabel}${runNoteText}`;\n  return text.trim() ? text : null;\n}\n\nexport function getPosteriorConfig(state: AppState): PosteriorConfig {\n  return state.posteriorConfig;\n}\n\nexport function formatPosteriorScore(value: number | null | undefined): string {\n  return formatScore(value);\n}\n", "import { getRecommendation } from './recommendation';\nimport {\n  AppState,\n  StopState,\n  createAppState,\n  mapRawStopToState,\n  selectActiveDay,\n  findNextToVisitIndex,\n  createLogEntry,\n  buildPosteriorSummary,\n  humanizeReason,\n  getPosteriorConfig,\n  formatPosteriorScore,\n  DEFAULT_POSTERIOR_CONFIG,\n} from './state';\nimport {\n  PosteriorPoolPosterior,\n  computeRemainingPoolPosterior,\n  serializePosterior,\n  serializePool,\n  updatePosteriorWithObservation,\n  updatePoolObservation,\n  PosteriorPoolSummary,\n  PosteriorSummary,\n} from './posterior';\n\ntype Nullable<T> = T | null;\n\ntype DecisionMeta = ReturnType<typeof getRecommendation>;\n\nconst appState: AppState = createAppState();\n\nlet stopCardTemplateCache: HTMLTemplateElement | null = null;\nlet stopCardTemplateErrorLogged = false;\n\nexport function init(doc: Document = document): void {\n  const dataElement = doc.getElementById('itinerary-data');\n  if (!dataElement) {\n    console.error('Itinerary data script tag not found.');\n    return;\n  }\n\n  try {\n    appState.itinerary = JSON.parse(dataElement.textContent || '{}');\n  } catch (err) {\n    console.error('Failed to parse itinerary JSON.', err);\n    return;\n  }\n\n  const days = Array.isArray(appState.itinerary?.days) ? appState.itinerary.days : [];\n  const activeDayId = doc.body?.dataset?.activeDayId;\n  const day = selectActiveDay(days, activeDayId ?? undefined);\n  if (!day) {\n    console.error('Unable to determine active day for itinerary.');\n    return;\n  }\n\n  appState.dayId = day.dayId ?? null;\n  if (doc.body && appState.dayId) {\n    doc.body.dataset.activeDayId = appState.dayId;\n  }\n\n  const dayLabel = doc.getElementById('active-day-label');\n  if (dayLabel && day.dayId) {\n    dayLabel.textContent = `Day ${day.dayId}`;\n  }\n\n  const stops = Array.isArray(day.stops) ? day.stops : [];\n  const config = getPosteriorConfig(appState) ?? DEFAULT_POSTERIOR_CONFIG;\n  appState.stops = stops\n    .filter((stop) => stop.type === 'store')\n    .map((stop) => mapRawStopToState(stop, config));\n\n  appState.currentIndex = findNextToVisitIndex(appState.stops);\n\n  const runInfo = doc.getElementById('run-info');\n  if (runInfo && appState.itinerary) {\n    const existing = runInfo.textContent?.trim();\n    if (!existing) {\n      const runId = appState.itinerary.runId ?? 'Unknown Run';\n      const runNote = appState.itinerary.runNote ? ` - ${appState.itinerary.runNote}` : '';\n      runInfo.textContent = `Run ID: ${runId}${runNote}`;\n    }\n  }\n\n  setupMQAOptions(doc);\n  renderAll(doc);\n  addEventListeners(doc);\n}\n\nfunction setupMQAOptions(doc: Document): void {\n  const container = doc.getElementById('mqa-select');\n  if (!container) return;\n  container.innerHTML = '';\n  Object.entries(appState.mqaMap).forEach(([key, value]) => {\n    const div = doc.createElement('div');\n    div.className = 'flex items-center p-3 rounded-lg border border-stone-200 hover:bg-stone-50';\n    div.innerHTML = `\n      <input id=\"mqa-${key.toLowerCase()}\" type=\"radio\" name=\"mqa\" value=\"${key}\" class=\"h-4 w-4 text-teal-600 border-stone-200 focus:ring-teal-500\">\n      <label for=\"mqa-${key.toLowerCase()}\" class=\"ml-3 block text-sm font-medium text-stone-700\">\n        ${key} <span class=\"text-xs text-stone-500\">(${value.toFixed(1)})</span>\n      </label>\n    `;\n    container.appendChild(div);\n  });\n}\n\nfunction renderAll(doc: Document): void {\n  const currentStop = appState.stops[appState.currentIndex];\n  const metrics = calculateMetrics(currentStop?.id);\n  renderDashboard(doc, metrics);\n  renderItineraryList(doc, currentStop ?? null);\n  renderCurrentStore(doc, currentStop ?? null);\n  renderTripLog(doc);\n  refreshRecommendationDisplay(doc);\n}\n\ninterface DashboardMetrics {\n  totalStores: number;\n  visitedStores: number;\n  overallAvgScore: string;\n  poolPosterior: PosteriorPoolPosterior | null;\n  currentPosterior: PosteriorSummary | null;\n  expectedRemQuality: string;\n}\n\nfunction calculateMetrics(excludeId: string | number | undefined): DashboardMetrics {\n  const config = getPosteriorConfig(appState);\n  const totalStores = appState.stops.length;\n  const visitedStores = appState.stops.filter((s) => s.status === 'visited').length;\n  const overallAvgScore =\n    totalStores > 0\n      ? (\n          appState.stops.reduce(\n            (sum, s) => sum + (typeof s.score === 'number' ? s.score : config.defaultScore),\n            0,\n          ) / totalStores\n        ).toFixed(1)\n      : '0.0';\n\n  const poolPosterior =\n    appState.stops.length > 0\n      ? computeRemainingPoolPosterior(appState.stops, config, appState.posteriorPool, excludeId)\n      : null;\n  const currentStop = appState.stops[appState.currentIndex];\n\n  return {\n    totalStores,\n    visitedStores,\n    overallAvgScore,\n    poolPosterior,\n    currentPosterior: currentStop ? serializePosterior(currentStop.posterior, config) : null,\n    expectedRemQuality: poolPosterior ? poolPosterior.mean.toFixed(2) : '0.0',\n  };\n}\n\nfunction renderDashboard(doc: Document, metrics: DashboardMetrics): void {\n  const { totalStores, visitedStores, overallAvgScore, poolPosterior, currentPosterior } = metrics;\n  setText(doc, 'dashboard-total-stores', String(totalStores));\n  setText(doc, 'dashboard-stores-visited', String(visitedStores));\n  setText(doc, 'dashboard-avg-jscore', overallAvgScore);\n  setText(doc, 'dashboard-expected-quality', poolPosterior ? poolPosterior.mean.toFixed(2) : '--');\n  setText(doc, 'dashboard-pool-uncertainty', poolPosterior ? `\u00B1${poolPosterior.std.toFixed(2)}` : '\u00B1--');\n  setText(doc, 'dashboard-current-mean', currentPosterior ? currentPosterior.mean.toFixed(2) : '--');\n  setText(\n    doc,\n    'dashboard-current-uncertainty',\n    currentPosterior ? `\u00B1${currentPosterior.std.toFixed(2)}` : '\u00B1--',\n  );\n  const currentUcbText =\n    currentPosterior && typeof currentPosterior.upper === 'number'\n      ? currentPosterior.upper.toFixed(2)\n      : '--';\n  const remainingUcbText =\n    poolPosterior && typeof poolPosterior.upper === 'number' ? poolPosterior.upper.toFixed(2) : '--';\n  setText(doc, 'dashboard-current-ucb', currentUcbText);\n  setText(doc, 'dashboard-remaining-ucb', remainingUcbText);\n}\n\nfunction renderItineraryList(doc: Document, currentStop: Nullable<StopState>): void {\n  const container = doc.getElementById('itinerary-list');\n  if (!container) return;\n  container.replaceChildren();\n  if (!getStopCardTemplate(doc)) {\n    return;\n  }\n  appState.stops.forEach((stop) => {\n    const awaitingStopId = appState.awaitingAdvance ? appState.activeDecisionStopId : null;\n    const isAwaitingCurrent = awaitingStopId != null && String(stop.id) === String(awaitingStopId);\n    const isCurrent =\n      (currentStop && stop.id === currentStop.id && stop.status === 'tovisit') || isAwaitingCurrent;\n    const card = createStopCardElement(doc, stop, {\n      highlight: isCurrent,\n      includeDropButton: stop.status === 'tovisit',\n    });\n    if (card) {\n      container.appendChild(card);\n    }\n  });\n}\n\nfunction renderCurrentStore(doc: Document, currentStop: Nullable<StopState>): void {\n  const nameEl = doc.getElementById('current-store-name');\n  const form = doc.getElementById('mqa-form');\n  if (!nameEl || !form) return;\n\n  const awaitingCurrent =\n    appState.awaitingAdvance &&\n    currentStop &&\n    String(currentStop.id) === String(appState.activeDecisionStopId);\n\n  if (!currentStop || (currentStop.status !== 'tovisit' && !awaitingCurrent)) {\n    nameEl.textContent = 'Trip Complete!';\n    (form as HTMLElement).style.display = 'none';\n    setText(doc, 'timeline-arrive-time', '--:--');\n    setText(doc, 'timeline-mqa-time', '--:--');\n    return;\n  }\n\n  (form as HTMLElement).style.display = awaitingCurrent ? 'none' : 'block';\n  while (nameEl.firstChild) {\n    nameEl.removeChild(nameEl.firstChild);\n  }\n  const currentName = typeof currentStop.name === 'string' ? currentStop.name : '';\n  if (currentStop.mapsUrl) {\n    const link = doc.createElement('a');\n    link.className = 'store-link';\n    link.href = currentStop.mapsUrl;\n    link.target = '_blank';\n    link.rel = 'noopener noreferrer';\n    link.textContent = currentName;\n    nameEl.appendChild(link);\n  } else {\n    nameEl.textContent = currentName;\n  }\n\n  if (currentStop.arrive) {\n    const [arriveH, arriveM] = currentStop.arrive.split(':').map(Number);\n    const mqaTime = new Date();\n    mqaTime.setHours(arriveH, arriveM + 30, 0, 0);\n    const mqaH = String(mqaTime.getHours()).padStart(2, '0');\n    const mqaM = String(mqaTime.getMinutes()).padStart(2, '0');\n    setText(doc, 'timeline-arrive-time', currentStop.arrive);\n    setText(doc, 'timeline-mqa-time', `${mqaH}:${mqaM}`);\n  } else {\n    setText(doc, 'timeline-arrive-time', '--:--');\n    setText(doc, 'timeline-mqa-time', '--:--');\n  }\n}\n\nfunction renderTripLog(doc: Document): void {\n  const container = doc.getElementById('trip-log');\n  if (!container) return;\n\n  if (appState.log.length === 0) {\n    container.innerHTML = '<p class=\"text-stone-500\">Your decisions will appear here.</p>';\n    return;\n  }\n\n  container.innerHTML = '';\n  appState.log.forEach((entry) => {\n    const div = doc.createElement('div');\n    div.className = 'p-2 border-b border-stone-100';\n    const posterior = entry.posterior;\n    const pool = entry.pool;\n    const mqaValueText = entry.mqaValue != null ? entry.mqaValue.toFixed(1) : '\u2014';\n    const summaryParts = [\n      `MQA: ${entry.mqa} (${mqaValueText})`,\n      entry.decisionReason ? `Reason: ${humanizeReason(entry.decisionReason)}` : null,\n    ].filter(Boolean);\n    div.innerHTML = `\n      <div class=\"flex justify-between items-start gap-3\">\n        <div>\n          <p class=\"font-semibold\">${entry.name}</p>\n          <p class=\"text-xs text-stone-500\">${summaryParts.join(' \u00B7 ')}</p>\n        </div>\n        <div class=\"text-right text-xs text-stone-500\">\n          <p class=\"font-mono text-sm\">${posterior.mean.toFixed(2)} \u00B1 ${posterior.std.toFixed(2)}</p>\n          <p>UCB: ${posterior.upper.toFixed(2)}</p>\n        </div>\n      </div>\n      <p class=\"text-xs text-stone-400 mt-1\">Pool \u03BC=${pool?.mean.toFixed(2) ?? '\u2014'} \u03C3=${\n      pool?.std.toFixed(2) ?? '\u2014'\n    } UCB=${pool?.upper.toFixed(2) ?? '\u2014'}</p>\n      <p class=\"text-xs text-stone-400\">${new Date(entry.timestamp).toLocaleTimeString()}</p>\n    `;\n    container.appendChild(div);\n  });\n}\n\nfunction refreshRecommendationDisplay(doc: Document): void {\n  if (!appState.lastRecommendation) return;\n  const { recommendation, meta, currentPosterior, poolPosterior } = appState.lastRecommendation;\n  updateRecommendationDisplay(doc, recommendation, meta, currentPosterior, poolPosterior);\n}\n\nfunction getStopCardTemplate(doc: Document): HTMLTemplateElement | null {\n  if (stopCardTemplateCache) {\n    return stopCardTemplateCache;\n  }\n\n  const template = doc.getElementById('stop-card-template');\n  if (template instanceof HTMLTemplateElement) {\n    stopCardTemplateCache = template;\n    return template;\n  }\n\n  if (!stopCardTemplateErrorLogged) {\n    console.error('Stop card template not found.');\n    stopCardTemplateErrorLogged = true;\n  }\n\n  return null;\n}\n\ninterface StopCardOptions {\n  highlight?: boolean;\n  includeDropButton?: boolean;\n}\n\nfunction createStopCardElement(\n  doc: Document,\n  stop: StopState,\n  options: StopCardOptions = {},\n): HTMLElement | null {\n  const template = getStopCardTemplate(doc);\n  if (!template) {\n    return null;\n  }\n\n  const fragment = template.content.cloneNode(true) as DocumentFragment;\n  const card = fragment.querySelector('.stop-card');\n  if (!(card instanceof HTMLElement)) {\n    return null;\n  }\n\n  const { highlight = false, includeDropButton = false } = options;\n\n  const stopId = stop?.id != null ? String(stop.id) : '';\n  if (stopId) {\n    card.id = `row-${stopId}`;\n    card.dataset.stopId = stopId;\n  } else {\n    card.removeAttribute('id');\n    delete card.dataset.stopId;\n  }\n\n  if (stop?.type != null) {\n    card.dataset.stopType = String(stop.type);\n  } else {\n    delete card.dataset.stopType;\n  }\n\n  card.classList.remove('status-tovisit', 'status-visited', 'status-dropped');\n  const statusClass = stop?.status ? `status-${stop.status}` : 'status-tovisit';\n  card.classList.add(statusClass);\n\n  if (highlight) {\n    card.classList.add('ring-2', 'ring-teal-500', 'shadow-md');\n    card.classList.remove('shadow-sm');\n  }\n\n  const stopName = typeof stop?.name === 'string' ? stop.name : '';\n  const nameTextEl = card.querySelector('.stop-name-text');\n  const nameLinkEl = card.querySelector('.stop-name-link') as HTMLAnchorElement | null;\n  if (nameTextEl) {\n    nameTextEl.textContent = stopName;\n  }\n  if (nameLinkEl) {\n    nameLinkEl.textContent = stopName;\n    if (stop?.mapsUrl) {\n      nameLinkEl.href = stop.mapsUrl;\n      nameLinkEl.classList.remove('hidden');\n      if (nameTextEl) {\n        nameTextEl.classList.add('hidden');\n      }\n    } else {\n      nameLinkEl.removeAttribute('href');\n      nameLinkEl.classList.add('hidden');\n      if (nameTextEl) {\n        nameTextEl.classList.remove('hidden');\n      }\n    }\n  }\n\n  const statusLabel =\n    stop?.status === 'visited'\n      ? `Visited \u2013 ${stop.mqa ?? 'n/a'}`\n      : stop?.status === 'dropped'\n      ? 'Dropped'\n      : 'To Visit';\n  const statusEl = card.querySelector('.stop-status');\n  if (statusEl) {\n    statusEl.textContent = statusLabel;\n  }\n\n  const posteriorMean = stop.posterior ? stop.posterior.mean.toFixed(2) : formatPosteriorScore(stop.score);\n  const posteriorStd = stop.posterior ? stop.posterior.std.toFixed(2) : '0.00';\n  const initialScore = formatPosteriorScore(stop.score);\n\n  const meanEl = card.querySelector('.stop-posterior-mean');\n  if (meanEl) {\n    meanEl.textContent = posteriorMean;\n  }\n\n  const uncertaintyEl = card.querySelector('.stop-posterior-uncertainty');\n  if (uncertaintyEl) {\n    uncertaintyEl.textContent = `Uncertainty\\u00A0:\\u00A0\u00B1${posteriorStd}`;\n  }\n\n  const initialScoreEl = card.querySelector('.stop-initial-score');\n  if (initialScoreEl) {\n    initialScoreEl.textContent = `Initial Score\\u00A0:\\u00A0${initialScore}`;\n  }\n\n  const dropButton = card.querySelector('.drop-store-button') as HTMLButtonElement | null;\n  if (dropButton) {\n    if (includeDropButton && stopId) {\n      dropButton.hidden = false;\n      dropButton.dataset.dropStopId = stopId;\n    } else {\n      dropButton.hidden = true;\n      dropButton.removeAttribute('data-drop-stop-id');\n    }\n  }\n\n  return card;\n}\n\nfunction addEventListeners(doc: Document): void {\n  const decisionButton = doc.getElementById('decision-button');\n  if (decisionButton) {\n    decisionButton.addEventListener('click', () => {\n      const selectedMQA = doc.querySelector<HTMLInputElement>('input[name=\"mqa\"]:checked');\n      if (!selectedMQA) {\n        window.alert('Please select a Measured Quality Assessment (MQA).');\n        return;\n      }\n      processDecision(doc, selectedMQA.value);\n    });\n  }\n\n  const bustButton = doc.getElementById('bust-button');\n  if (bustButton) {\n    bustButton.addEventListener('click', () => {\n      processDecision(doc, 'Bust');\n    });\n  }\n\n  const itineraryList = doc.getElementById('itinerary-list');\n  if (itineraryList) {\n    itineraryList.addEventListener('click', (event) => {\n      const target = event.target as Element | null;\n      if (!target) {\n        return;\n      }\n      const button = target.closest<HTMLButtonElement>('button[data-drop-stop-id]');\n      if (!button) {\n        return;\n      }\n      event.preventDefault();\n      const stopId = button.getAttribute('data-drop-stop-id');\n      if (!stopId) {\n        return;\n      }\n      const stop = appState.stops.find((s) => String(s.id) === stopId);\n      if (!stop || stop.status !== 'tovisit') {\n        return;\n      }\n      const matchedPendingDrop =\n        !!appState.pendingDrop && String(appState.pendingDrop.stopId ?? appState.pendingDrop.id) === stopId;\n      const confirmed = window.confirm(`Drop ${stop.name}?\\n\\nThis will mark the store as dropped.`);\n      if (!confirmed) {\n        return;\n      }\n      const dropResult = dropStopById(stopId, 'manual-drop');\n      if (!dropResult) {\n        if (matchedPendingDrop) {\n          appState.pendingDrop = null;\n          renderAll(doc);\n        }\n        return;\n      }\n      if (matchedPendingDrop) {\n        appState.pendingDrop = null;\n        renderAll(doc);\n      } else if (dropResult.index === appState.currentIndex) {\n        advanceToNextStore(doc);\n      } else {\n        renderAll(doc);\n      }\n    });\n  }\n\n  const exportButton = doc.getElementById('export-button');\n  if (exportButton) {\n    exportButton.addEventListener('click', () => {\n      const poolSnapshot = appState.stops.length\n        ? computeRemainingPoolPosterior(appState.stops, getPosteriorConfig(appState), appState.posteriorPool)\n        : null;\n      const exportData = {\n        runInfo: appState.itinerary,\n        activeDayId: appState.dayId,\n        finalStopsState: appState.stops.map((stop) => ({\n          id: stop.id,\n          name: stop.name,\n          type: stop.type,\n          arrive: stop.arrive,\n          depart: stop.depart,\n          score: stop.score,\n          status: stop.status,\n          mqa: stop.mqa ?? null,\n          mqaValue: stop.mqaValue ?? null,\n          decision: stop.decision ?? null,\n          decisionReason: stop.decisionReason ?? null,\n          posterior: serializePosterior(stop.posterior, getPosteriorConfig(appState)),\n        })),\n        tripLog: appState.log,\n        posteriorPool: poolSnapshot\n          ? {\n              ...serializePool(poolSnapshot),\n              observedAlpha: appState.posteriorPool.observedAlpha,\n              observedBeta: appState.posteriorPool.observedBeta,\n              observationCount: appState.posteriorPool.observationCount,\n              totalObservedQuality: appState.posteriorPool.totalObservedQuality,\n            }\n          : null,\n        posteriorConfig: getPosteriorConfig(appState),\n      };\n      const dataStr = JSON.stringify(exportData, null, 2);\n      const dataBlob = new Blob([dataStr], { type: 'application/json' });\n      const url = URL.createObjectURL(dataBlob);\n      const a = doc.createElement('a');\n      a.href = url;\n      const runId = appState.itinerary?.runId ?? 'trip';\n      a.download = `rust-belt-trip-${runId}-results.json`;\n      doc.body.appendChild(a);\n      a.click();\n      doc.body.removeChild(a);\n      URL.revokeObjectURL(url);\n    });\n  }\n}\n\nfunction processDecision(doc: Document, mqaKey: string): void {\n  const currentStop = appState.stops[appState.currentIndex];\n  if (!currentStop) return;\n\n  const mqaValue = appState.mqaMap[mqaKey];\n  if (typeof mqaValue !== 'number') {\n    console.warn('Unknown MQA key selected:', mqaKey);\n    return;\n  }\n\n  const config = getPosteriorConfig(appState);\n  updatePosteriorWithObservation(currentStop.posterior, mqaValue, config);\n  updatePoolObservation(appState.posteriorPool, mqaValue, config);\n\n  const poolPosterior = computeRemainingPoolPosterior(appState.stops, config, appState.posteriorPool, currentStop.id);\n  const decisionMeta = getRecommendation(currentStop.posterior, poolPosterior, mqaKey, mqaValue);\n  const recommendation = decisionMeta.decision;\n  const posteriorSummary = serializePosterior(currentStop.posterior, config);\n  const poolSummary = poolPosterior ? serializePool(poolPosterior) : null;\n  const recommendationMeta: DecisionMeta = { ...decisionMeta };\n\n  appState.lastRecommendation = {\n    recommendation,\n    meta: recommendationMeta,\n    currentPosterior: posteriorSummary,\n    poolPosterior: poolSummary,\n  };\n\n  updateRecommendationDisplay(doc, recommendation, recommendationMeta, posteriorSummary, poolSummary);\n\n  currentStop.mqa = mqaKey;\n  currentStop.mqaValue = mqaValue;\n  currentStop.decision = recommendation;\n  currentStop.decisionReason = decisionMeta.reason;\n  currentStop.status = 'visited';\n  currentStop.posteriorSummary = buildPosteriorSummary(currentStop.posterior, recommendationMeta);\n\n  const shouldPauseBeforeAdvancing = recommendation === 'Stay' && mqaKey === 'Exceptional';\n  appState.awaitingAdvance = shouldPauseBeforeAdvancing;\n  appState.activeDecisionStopId = shouldPauseBeforeAdvancing ? currentStop.id : null;\n\n  const logEntry = createLogEntry({\n    stop: currentStop,\n    mqaKey,\n    mqaValue,\n    recommendation,\n    decisionReason: decisionMeta.reason,\n    decisionMeta,\n    posteriorSummary,\n    poolSummary,\n  });\n  appState.log.push(logEntry);\n\n  renderAll(doc);\n\n  if (recommendation === 'Stay' && mqaKey === 'Exceptional') {\n    handleOverrun(doc);\n  } else {\n    advanceToNextStore(doc);\n  }\n}\n\nfunction updateRecommendationDisplay(\n  doc: Document,\n  recommendation: string,\n  meta: DecisionMeta,\n  currentPosterior: PosteriorSummary | null,\n  poolPosterior: PosteriorPoolSummary | null,\n): void {\n  const display = doc.getElementById('recommendation-display');\n  if (!display) return;\n  const diffText = meta.diff != null ? `\u0394Upper Confidence Bound (UCB)=${meta.diff.toFixed(2)}` : '';\n  const zText = meta.zScore != null && Number.isFinite(meta.zScore) ? `z=${meta.zScore.toFixed(2)}` : '';\n  const reason = humanizeReason(meta.reason);\n  const currentUcbText =\n    meta.currentUcb != null && Number.isFinite(meta.currentUcb)\n      ? meta.currentUcb.toFixed(2)\n      : '--';\n  const currentSummary = currentPosterior\n    ? `Current \u03BC=${currentPosterior.mean.toFixed(2)} \u03C3=${currentPosterior.std.toFixed(2)} Upper Confidence Bound (UCB)=${currentUcbText}`\n    : '';\n  const poolUcbText =\n    meta.remainingUcb != null && Number.isFinite(meta.remainingUcb)\n      ? meta.remainingUcb.toFixed(2)\n      : '--';\n  const poolSummary = poolPosterior\n    ? `Pool \u03BC=${poolPosterior.mean.toFixed(2)} \u03C3=${poolPosterior.std.toFixed(2)} Upper Confidence Bound (UCB)=${poolUcbText}`\n    : '';\n\n  const metaLine = [reason, diffText, zText].filter(Boolean).join(' \u00B7 ');\n  const summaryLine = [currentSummary, poolSummary].filter(Boolean).join(' | ');\n\n  const pendingDropMarkup = buildPendingDropMarkup();\n  const advanceControlsMarkup = buildAdvanceControlsMarkup();\n\n  const baseMarkup = `\n      <p class=\"text-lg font-medium\">Recommendation:</p>\n      <p class=\"text-3xl font-bold recommendation-${recommendation.toLowerCase()}\">${recommendation.toUpperCase()}</p>\n      <p class=\"text-sm text-stone-600\">${metaLine}</p>\n      <p class=\"text-xs text-stone-500\">${summaryLine}</p>\n    `;\n\n  display.innerHTML = `${baseMarkup}${pendingDropMarkup}${advanceControlsMarkup}`;\n\n  if (pendingDropMarkup) {\n    const confirmButton = display.querySelector('[data-action=\"confirm-pending-drop\"]') as\n      | HTMLButtonElement\n      | null;\n    if (confirmButton) {\n      confirmButton.addEventListener('click', () => confirmPendingDrop(doc));\n    }\n    const cancelButton = display.querySelector('[data-action=\"cancel-pending-drop\"]') as\n      | HTMLButtonElement\n      | null;\n    if (cancelButton) {\n      cancelButton.addEventListener('click', () => cancelPendingDrop(doc));\n    }\n  }\n  if (advanceControlsMarkup) {\n    const advanceButton = display.querySelector('[data-action=\"advance-after-decision\"]') as\n      | HTMLButtonElement\n      | null;\n    if (advanceButton) {\n      advanceButton.addEventListener('click', () => handleAdvanceAfterDecision(doc));\n    }\n  }\n}\n\nfunction buildPendingDropMarkup(): string {\n  const pendingDrop = appState.pendingDrop;\n  if (!pendingDrop) {\n    return '';\n  }\n  const pendingStop = appState.stops.find(\n    (s) => String(s.id) === String(pendingDrop.stopId ?? pendingDrop.id ?? ''),\n  );\n  if (!pendingStop || pendingStop.status !== 'tovisit') {\n    appState.pendingDrop = null;\n    return '';\n  }\n  const nameMarkup = pendingStop.mapsUrl\n    ? `<a class=\"store-link\" href=\"${pendingStop.mapsUrl}\" target=\"_blank\" rel=\"noopener noreferrer\">${pendingStop.name}</a>`\n    : pendingStop.name;\n  const posteriorMean = pendingStop.posterior ? pendingStop.posterior.mean.toFixed(2) : formatPosteriorScore(pendingStop.score);\n  const posteriorStd = pendingStop.posterior ? pendingStop.posterior.std.toFixed(2) : '0.00';\n  const initialScore = formatPosteriorScore(pendingStop.score);\n  const statusValue = pendingStop.status as string;\n  const statusLabel =\n    statusValue === 'visited'\n      ? `Visited \u2013 ${pendingStop.mqa ?? 'n/a'}`\n      : statusValue === 'dropped'\n      ? 'Dropped'\n      : 'To Visit';\n  const scheduleParts: string[] = [];\n  if (pendingStop.arrive) {\n    scheduleParts.push(`Arrive ${pendingStop.arrive}`);\n  }\n  if (pendingStop.depart) {\n    scheduleParts.push(`Depart ${pendingStop.depart}`);\n  }\n  const scheduleMarkup =\n    scheduleParts.length > 0 ? `<p class=\"pending-drop-store-schedule\">${scheduleParts.join(' \u00B7 ')}</p>` : '';\n  const storeSummaryMarkup = `\n          <div class=\"pending-drop-store p-3 rounded-md shadow-sm\">\n            <div class=\"flex justify-between items-start gap-3\">\n              <div>\n                <p class=\"font-semibold pending-drop-store-name\">${nameMarkup}</p>\n                <p class=\"text-xs text-stone-500 pending-drop-store-status\">${statusLabel}</p>\n              </div>\n              <div class=\"flex flex-col items-end text-right gap-2\">\n                <div class=\"text-right\">\n                  <p class=\"font-mono text-sm bg-stone-200 text-stone-700 px-2 py-1 rounded pending-drop-store-mean\">${posteriorMean}</p>\n                  <div class=\"mt-2 space-y-1 leading-tight pending-drop-store-metrics\">\n                    <p class=\"text-xs uppercase tracking-wide text-stone-600\">Uncertainty&nbsp;:&nbsp;\u00B1${posteriorStd}</p>\n                    <p class=\"text-xs uppercase tracking-wide text-stone-600\">Initial Score&nbsp;:&nbsp;${initialScore}</p>\n                  </div>\n                </div>\n              </div>\n            </div>\n            ${scheduleMarkup}\n          </div>\n        `;\n\n  return `\n      <div class=\"pending-drop-panel mt-4 rounded-lg p-4\">\n        <p class=\"pending-drop-title\">Extend your stay?</p>\n        <p class=\"pending-drop-subtitle\">Drop the lowest-rated remaining store to stay longer.</p>\n        ${storeSummaryMarkup}\n        <div class=\"pending-drop-actions\">\n          <button\n            type=\"button\"\n            class=\"pending-drop-action pending-drop-action--danger\"\n            data-action=\"confirm-pending-drop\"\n            data-stop-id=\"${pendingStop.id}\"\n          >\n            Drop store?\n          </button>\n          <button\n            type=\"button\"\n            class=\"pending-drop-action pending-drop-action--secondary\"\n            data-action=\"cancel-pending-drop\"\n          >\n            Do NOT Drop\n          </button>\n        </div>\n      </div>\n    `;\n}\n\nfunction buildAdvanceControlsMarkup(): string {\n  const awaitingAdvance = appState.awaitingAdvance && appState.activeDecisionStopId != null;\n  if (!awaitingAdvance) {\n    return '';\n  }\n  const nextDisabled = !!appState.pendingDrop;\n  const disabledAttr = nextDisabled ? 'disabled aria-disabled=\"true\"' : '';\n  const baseButtonClass =\n    'next-store-button rounded-md px-3 py-2 text-sm font-semibold focus:outline-none focus:ring-2 focus:ring-offset-1';\n  const buttonClass = nextDisabled\n    ? `${baseButtonClass} bg-stone-300 text-stone-500 cursor-not-allowed focus:ring-stone-300`\n    : `${baseButtonClass} bg-teal-600 text-white shadow hover:bg-teal-700 focus:ring-teal-500`;\n  const helperText = nextDisabled\n    ? '<p class=\"text-xs text-stone-500\">Resolve the drop decision before continuing.</p>'\n    : '';\n  return `\n        <div class=\"mt-4 flex flex-col gap-2\">\n          <button type=\"button\" class=\"${buttonClass}\" data-action=\"advance-after-decision\" ${disabledAttr}>\n            Next store\n          </button>\n          ${helperText}\n        </div>\n      `;\n}\n\nfunction dropStopById(stopId: string | number, reason: string): { stop: StopState; index: number } | null {\n  const normalizedId = String(stopId);\n  const stopIndex = appState.stops.findIndex((s) => String(s.id) === normalizedId);\n  if (stopIndex === -1) return null;\n\n  const stop = appState.stops[stopIndex];\n  if (stop.status !== 'tovisit') {\n    return null;\n  }\n\n  stop.status = 'dropped';\n  stop.decision = 'Dropped';\n  stop.decisionReason = reason;\n\n  const config = getPosteriorConfig(appState);\n  const posteriorSummary = serializePosterior(stop.posterior, config);\n  stop.posteriorSummary = {\n    ...posteriorSummary,\n    diff: null,\n    zScore: null,\n    currentUcb: null,\n    remainingUcb: null,\n  };\n\n  const poolSnapshot = computeRemainingPoolPosterior(appState.stops, config, appState.posteriorPool);\n\n  appState.log.push({\n    name: stop.name,\n    mapsUrl: stop.mapsUrl,\n    mqa: 'N/A',\n    mqaValue: null,\n    decision: 'Dropped',\n    decisionReason: reason,\n    diff: null,\n    zScore: null,\n    currentUcb: null,\n    remainingUcb: null,\n    observationCount: null,\n    posterior: posteriorSummary,\n    pool: serializePool(poolSnapshot),\n    timestamp: new Date().toISOString(),\n  });\n\n  if (\n    appState.pendingDrop &&\n    String(appState.pendingDrop.stopId ?? appState.pendingDrop.id) === normalizedId\n  ) {\n    appState.pendingDrop = null;\n  }\n\n  return { stop, index: stopIndex };\n}\n\nfunction handleAdvanceAfterDecision(doc: Document): void {\n  if (appState.pendingDrop) {\n    return;\n  }\n  appState.awaitingAdvance = false;\n  appState.activeDecisionStopId = null;\n  advanceToNextStore(doc);\n}\n\nfunction confirmPendingDrop(doc: Document): void {\n  const pendingDrop = appState.pendingDrop;\n  if (!pendingDrop) return;\n  const stopId = pendingDrop.stopId ?? pendingDrop.id;\n  if (stopId == null) {\n    appState.pendingDrop = null;\n    renderAll(doc);\n    return;\n  }\n  const result = dropStopById(stopId, 'stay-drop');\n  if (!result) {\n    appState.pendingDrop = null;\n    renderAll(doc);\n    return;\n  }\n  appState.pendingDrop = null;\n  renderAll(doc);\n}\n\nfunction cancelPendingDrop(doc: Document): void {\n  appState.pendingDrop = null;\n  renderAll(doc);\n}\n\nfunction advanceToNextStore(doc: Document): void {\n  appState.currentIndex = findNextToVisitIndex(appState.stops);\n  renderAll(doc);\n}\n\nfunction handleOverrun(doc: Document): void {\n  const remainingStops = appState.stops.filter((s) => s.status === 'tovisit');\n  if (remainingStops.length === 0) {\n    appState.pendingDrop = null;\n    appState.awaitingAdvance = false;\n    appState.activeDecisionStopId = null;\n    advanceToNextStore(doc);\n    return;\n  }\n  const lowestStop = [...remainingStops].sort(\n    (a, b) => (a.posterior.mean ?? 0) - (b.posterior.mean ?? 0),\n  )[0];\n  if (!lowestStop) {\n    return;\n  }\n  appState.pendingDrop = { stopId: lowestStop.id };\n  renderAll(doc);\n}\n\nfunction setText(doc: Document, id: string, value: string): void {\n  const el = doc.getElementById(id);\n  if (!el) return;\n  el.textContent = value;\n}\n\nif (typeof document !== 'undefined') {\n  document.addEventListener('DOMContentLoaded', () => init(document));\n}\n\nexport default { init };\n"],
  "mappings": "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",
  "names": ["diff", "_a", "_b"]
}
