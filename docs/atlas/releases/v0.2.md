# Atlas v0.2 Release Notes

_Date: 2024-04-30_

## TL;DR
- Metro anchor detection graduates into the CLI with configurable DBSCAN/HDBSCAN presets, id-prefix controls, metrics sidecars, and schema-validated exports for anchors and curated sub-clusters.
- Posterior trace collection is unified across prior/posterior/blend stages with per-stage toggles, CSV/JSONL writers, and a versioned schema contract.
- Diagnostics now ship by default as versioned JSON, HTML, and Parquet sidecars summarising correlations, distributions, QA flags, and anchor leverage.
- Solver consumes the full Atlas artifact bundle (scores, anchors, clusters, traces, diagnostics) under a shared `schema/atlas/v1` contract, with integration tests covering CLI + Node handoffs.
- Docs, fixtures, and task board close out the v0.2 release scope with refreshed quickstarts, data dictionary references, and a formal release checklist.

---

## Metro anchors & curated clusters
- `rustbelt-atlas anchors` exposes density-based metro detection with DBSCAN/HDBSCAN knobs (`--algorithm`, `--eps`, `--min-samples`, `--metric`, `--min-cluster-size`, `--cluster-selection-epsilon`).
- Stable anchor ids can be driven by metro ids or explicit `--id-prefix` strings; the CLI writes anchors, store assignments, and metrics summaries in one shot.
- Sub-clusters now materialise via `rustbelt-atlas subclusters`, consuming a JSON topology spec and emitting lineage-aware hierarchy records.
- JSON Schema contracts for anchors and clusters live at `schema/atlas/v1/anchor.schema.json` and `schema/atlas/v1/cluster.schema.json`, enabling downstream validation.

## Posterior trace exports
- A unified trace writer now emits combined prior/posterior/blend traces (`--trace-out`) with explicit format control (`--trace-format jsonl|csv`).
- Posterior-only exports (`--posterior-trace`, `--posterior-trace-format`) retain per-store model diagnostics.
- Include/exclude switches (`--include-prior-trace`, `--include-posterior-trace`, `--include-blend-trace`) make it cheap to dial scope for audits.
- Traces are backed by the versioned schema + examples under `schema/atlas/v1/trace.schema.json` and `schema/atlas/v1/trace-record.example.json` for contract drift detection.

## Diagnostics sidecars
- Diagnostics are enabled by default; disable with `--no-diagnostics` or redirect via `--diagnostics-dir`.
- Emitted artifacts share the `atlas-diagnostics-v0.2` basename across JSON (correlations, distributions, QA signals), HTML (human-readable summary), and Parquet (machine-friendly frame).
- Payloads capture anchor assignment coverage, optional sub-cluster counts, lambda weights, and regression-friendly metadata to ensure coverage across scoring modes.

## Solver integration & validation hooks
- CLI score writes are validated against `schema/atlas/v1/score.schema.json` before hitting disk; anchors/sub-clusters share the same pipeline.
- Solver CLI integration tests load the frozen Atlas fixtures, assert schema conformance (scores, anchors, clusters, traces), and execute solver runs that read Atlas-scored trips end-to-end.
- Shared versioning (`TRACE_SCHEMA_VERSION`, `DIAGNOSTICS_VERSION`, schema filenames) keeps Atlas/Solver artefacts in sync for future upgrades.

## Documentation & fixtures
- `docs/atlas/README.md` and `rust-belt-atlas.md` now call out v0.2 diagnostics, anchor/sub-cluster commands, and trace schema anchors.
- Atlas user guide retains the v0.1 quickstart while pointing to the latest release notes for production usage context.
- Synthetic fixtures under `packages/atlas-python/src/atlas/fixtures/dense_urban/` carry the refreshed anchors, traces, diagnostics, and trip payloads exercised by integration suites.

## Upgrade checklist
1. Install/update `atlas-python` (`pip install -e .[dev]`).
2. Regenerate metro scores with `rustbelt-atlas score`, ensuring diagnostics/traces land in the desired directory.
3. Derive anchors via `rustbelt-atlas anchors`, and feed curated spec files into `rustbelt-atlas subclusters` as needed.
4. Sync Solver fixtures/tests by running `npm test` under `packages/solver-cli`.
5. Review the diagnostics HTML for leverage/outlier warnings before circulating Atlas outputs to routing stakeholders.

## Validation & contract notes
- Any schema bump requires a coordinated update across Atlas CLI, schema definitions, fixtures, and Solver validation tests; bump `TRACE_SCHEMA_VERSION` and `DIAGNOSTICS_VERSION` in tandem.
- Versioned filenames (`atlas-diagnostics-v0.2.*`) are enforced by the diagnostics writers to prevent mixing artifacts from different Atlas releases in shared storage.
- Schema validation runs before writing outputs, so CLI invocations will fail fast with actionable error messages if payloads drift.

---

*Atlas v0.2 cements the scoring â‡„ routing handshake: anchors and diagnostics guide the day design, traces and schemas keep it auditable, and Solver integration ensures the handoff holds under real itineraries.*
